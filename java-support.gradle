
/**
 * Common Gradle script configuration for Java projects and tasks.
 * 
 * @author Emanuel Rabina
 */

project.ext.artifact = ''

sourceSets {
	main {
		java {
			srcDir 'Java'
		}
		resources {
			srcDir 'Resources'
		}
		output.classesDir   = 'Classes'
		output.resourcesDir = 'Classes'
	}
	test {
		java {
			srcDir 'Tests'
		}
		output.classesDir   = 'Classes'
		output.resourcesDir = 'Classes'
	}
}

/**
 * Fix for Gradle's JAR task putting duplicates in the resulting archive.  Uses
 * the Ant JAR task instead.
 */
task jar(
	dependsOn: JavaPlugin.CLASSES_TASK_NAME,
	overwrite: true,
	type: Jar) {

	doFirst {
		baseName = "${project.artifact}"
		archiveName = "${baseName}-${version}.${extension}"
	}
	doLast {
		ant.jar(
			destfile: "${archivePath}",
			duplicate: 'preserve',
			excludes: '**/tests/*') {
			fileset(dir: sourceSets.main.output.classesDir)
			fileset(dir: sourceSets.main.output.resourcesDir)
		}
	}
}
