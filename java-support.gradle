
/**
 * Common Gradle script configuration for Java projects and tasks.
 * 
 * @author Emanuel Rabina
 */

project.ext.artifact = ''

sourceSets {
	main {
		java {
			srcDir 'Java'
		}
		resources {
			srcDir 'Resources'
		}
		output.classesDir   = 'Classes'
		output.resourcesDir = 'Classes'
	}
	test {
		java {
			srcDir 'Tests'
		}
		output.classesDir   = 'Classes'
		output.resourcesDir = 'Classes'
	}
}

/**
 * Fix for Gradle's JAR task putting duplicates in the resulting archive with my
 * setup.
 */
task jar(
	description: 'Assembles a jar archive containing the main classes.',
	dependsOn: JavaPlugin.CLASSES_TASK_NAME,
	group: BasePlugin.BUILD_GROUP,
	overwrite: true,
	type: Jar) {

	inputs.dir sourceSets.main.output.classesDir

	exclude('**/tests/*')
	includeEmptyDirs = false
	doFirst {
		baseName = "${project.artifact}"
	}
	from(sourceSets.main.output.classesDir)
}
project.defaultArtifacts.addCandidate(new org.gradle.api.internal.artifacts.publish.ArchivePublishArtifact(jar));
artifacts {
	runtime jar
}
